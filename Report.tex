\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
%\usepackage[colorinlistoftodos]{todonotes}
\usepackage[left=1.00cm, right=1.00cm, top=1.00cm, bottom=1.50cm]{geometry}
\author{Federica Consoli}
\title{Web Application Challenge \\ \large Ethical Hacking Lab}

\begin{document}
	\maketitle
	%INTRODUCTION
	\section*{Introduction}
		The goal of this report is to illustrate the steps taken to win the Web Application Challenge for the Ethical Hacking lab. For each level, there will be a short descritpion of the attack, what tools or command were used and which secrets were obtained.\\\\The challenge started at
		 \texttt{http://eth-lab.di.uniroma1.it:55335/uegeteekairaigie}.
		 
	%LEVEL 1
	\section*{Level 1}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55335/uegeteekairaigie }\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55183/equaqueiveewaeva}\\\\
	Using the tool \texttt{curl} I was able to retrieve the source of the web page. When looking at it, I noticed that the button of the login form was invoking a function called \texttt{verify} whenever clicked. Using \texttt{curl} once again, I was able to retrieve the function verify, as showed below.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL1/curl}
		\label{fig:curl}
	\end{figure}
	
	This allowed me to retrieve the login details I needed (username: \texttt{SCRIPT}, password: \texttt{KIDDIE}) to obtain the url for the second challenge, as showed below.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL1/secret}
		\label{fig:secret1}
	\end{figure}
	\newpage

	%LEVEL 2
	\section*{Level 2}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55183/equaqueiveewaeva}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55211/uipahphezieceefu}\\\\
	Once again, I grabbed the web page using \texttt{curl}. I was initially misled by the presence of the MD5 hash of the correct password, but I then realized I did not need that solve the challenge: there was an image tag that pointed at  \texttt{scrt.png} and with the visibility property set at \texttt{hidden}, so I downloaded it using the \texttt{wget} tool.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL2/secret}
		\label{fig:secret2}
	\end{figure}
	This way, I obtained the password \texttt{NINJAkitten}, which allowed me to get the URL of the next challenge.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL2/win}
		\label{fig:win2}
	\end{figure}

	%LEVEL 3
	\section*{Level 3}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55211/uipahphezieceefu}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55321/pileyooquaitaewu}\\\\
	The first thing I tried for this level was entering a random combination of username and password, and I what I received was an error message saying that I needed to be an admin in order to login. After retrieving the webpage with \texttt{curl}, I noticed an hidden parameter called \texttt{admin} set to \texttt{False}. I then used \texttt{burp} as a proxy to intercept the http requests with the server, so that I could be able to edit the parameters in the \texttt{POST} request.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.6\linewidth]{LVL3/admin}
		\label{fig:admin3}
	\end{figure}After changing the value of the \texttt{admin} parameter to \texttt{True}, I was able to retrieve the secret for the next challenge, as shown below.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL3/secret}
		\label{fig:win3}
	\end{figure}	 

	%LEVEL 4
	\section*{Level 4}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55321/pileyooquaitaewu}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55128/gaijeifieleeshee}\\\\
	When clicking on the button "Verify my browser" I received an alert saying that only connections from \textit{``Kevin Browser Rocks"} are accepted. I once again used \texttt{burp} as a proxy to edit the header of the http request, changing the value of the property User-Agent to ``Kevin Browser Rocks". After clicking on the button again, I received another alert saying that only connections from \texttt{.ru} domains were accepted.\\
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL4/final}
		\label{fig:russian4}
	\end{figure}
	As shown above, I modified the request headers again, this time changing both the User-Agent and the Referer fields. This allowed me to retrieve the secret.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL4/secret}
		\label{fig:secret4}
	\end{figure}
	\newpage

	%LEVEL 5
	\section*{Level 5}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55128/gaijeifieleeshee}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55034/ahsoophiecikiesh }\\\\
	I retrieved the web page using \texttt{curl} and I noticed an HTML comment saying ``Never show secret.txt to the user". When I visited that page, I was presented with the following message:
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.5\linewidth]{LVL5/text}
		\label{fig:comment5}
	\end{figure}
	I then used \text{burp} to edit the http request for \texttt{cgi-bin/getsecret.js}, adding the Referer parameter, as follows:
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL5/referer}
		\label{fig:referer5}
	\end{figure}
	This allowed me to win the challenge and the retrieve the secret,
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL5/secret}
		\label{fig:secret5}
	\end{figure}


	%LEVEL 6
	\section*{Level 6}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55034/ahsoophiecikiesh }\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55368/eegathaiquaephei}\\\\
	For this first level, I tried a couple of random combinations of username and password, but I would only get an error message saying the username was incorrect. I then tried using the username \texttt{admin} with password \texttt{admin}, and I was able to get to the page below.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.6\linewidth]{LVL6/login}
		\label{fig:login6}
	\end{figure}
	I noticed the the parameter \texttt{uid=0} in the url, so I tried to change it to \texttt{1} and noticed that it would give info about another user, Angelo. I kept on manually increasing the value of the parameter, and when I reached \texttt{uid=6} I was able to obtain the secret.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.6\linewidth]{LVL6/secret}
		\label{fig:secret6}
	\end{figure}


	%LEVEL 7
	\section*{Level 7}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55368/eegathaiquaephei}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55508/eequohphaifiehee}\\\\
	This level was tricky. When I logged in using an email address, I received a message saying that I was logged in as a guest, but the secret would only be available to teachers. I tried using \texttt{burp} and \texttt{curl} to see if there were any hidden parameters I could use (I was actually looking for a \texttt{boolean} parameter called teacher or something similar), but I was not successful. After being stuck for a couple of ours, I decided to try professor Spognardi's email, and surprisingly it worked.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL7/win}
		\label{fig:win7}
	\end{figure}

	%LEVEL 8
	\section*{Level 8}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55508/eequohphaifiehee}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55511/eigahvemoweipiep}\\\\
	I started this level by trying to log in with username \texttt{admin} and password \texttt{admin}, which worked, although no secret was available.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL8/admin}
		\label{fig:admin8}
	\end{figure}
	
	I noticed the parameter \texttt{user=nqzva} in the URL, so I tried to change it to ``messyadmin" (since this username appeared on the initial page of the level), but that did not work. I then realized that \texttt{nqzva} was simply the output of a Caesar Cipher with \texttt{shift=13} applied to the word \texttt{admin}. I encrypted ``messyadmin" with the same kind of cipher (the result was \texttt{zrfflnqzva}) and used it in the URL, which allowed me to beat the challenge.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL8/win}
		\label{fig:win8}
	\end{figure}

	%LEVEL 9
	\section*{Level 9}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55511/eigahvemoweipiep}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55093/pohvaireyingithe}\\\\
	I tried logging in with a random email and a password, but I was presented with a page saying that the secret was only available for admins. After that, I used \texttt{curl} to retrieve the page, and I noticed a comment saying ``Never show sessions.txt to the users". I visited the page and I was able to retrieve the id of a session cookie.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL9/cookie}
		\label{fig:cookie9}
	\end{figure}
	I used \texttt{burp} to intercept the packet and change the value of the cookie using the id I previously discovered (as shown above), and I was able to retrieve the secret for the next challenge.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL9/secret}
		\label{fig:secret9}
	\end{figure}
	
	%LEVEL 10
	\section*{Level 10}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55093/pohvaireyingithe}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55170/zeezoowietaighei}\\\\
	After retrieving the web page with \texttt{curl}, I noticed that it contained four usernames and password hashes, which were used by the function \texttt{checkPassword()} to verify the login credentials inserted in the form. I used John the Ripper to crack the hash, feeding it an input file with \texttt{username:hash} in each line.\begin{figure}[H]
		\centering
		\includegraphics[width=0.9\linewidth]{LVL10/hash}
		\label{fig:john}
	\end{figure}As shown in the picture above, the user \texttt{admin} had password \texttt{qwertyuiop}, which was very easy to crack. These credentials allowed me to proceed to the next challenge.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.9\linewidth]{LVL10/secret}
		\label{fig:secret10}
	\end{figure} 	

	%LEVEL 11
	\section*{Level 11}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55170/zeezoowietaighei}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55199/urahreeghahjeugh/}\\\\
	I retrieved the web page using \texttt{curl}, and I noticed that the passcode inserted in the login was checked against a local hash. I created a Python script (below) to identify the passcode.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.9\linewidth]{LVL11/md5}
		\label{fig:md5}
	\end{figure}
According to the body of the \texttt{checkPassword()} function, the passcode is a number between 1 and 999999, and it was hashed together with a static salt.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL11/passcode}
		\label{fig:foundhash}
	\end{figure}
After retrieving the passcode, I used it in the login form and I was able to win the challenge. Below is the secret I received.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL11/secret}
		\label{fig:secret11}
	\end{figure}
	%LEVEL 12
	\section*{Level 12}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55199/urahreeghahjeugh/}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55352/thozeewileiseero}\\\\
	For this level, I retrieved the web page using \text{curl} and noticed a parameter named \texttt{filter} for the page \texttt{/cgi-bin/users.php} which would only print the name of the specified user. After unsuccessfully trying to perform SQL injection, I tried to check if it was possible to inject bash command. I intercepted the request using \texttt{burp} and modified it adding a bash command.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL12/test}
		\label{fig:test12}
	\end{figure}
 	The test was successful and the line "test" was printed, so I tried again, this time using the command \texttt{ls}, which showed the presence of the file \texttt{secretuser.txt}. I issued the command \texttt{cat secretuser.txt}, which allowed me to retrieve the secret for the next challenge.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.7\linewidth]{LVL12/secret}
		\label{fig:secret12}
	\end{figure}

	%LEVEL 13
	\section*{Level 13}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55352/thozeewileiseero}\\
	\textbf{SECRET: }\texttt{http://eth-lab.di.uniroma1.it:55367/aixedateediperai}\\\\
	This level was extremely at difficult at first, because it did not work well for my browser. Whenever I typed something in the input form, the resulting request would be for \texttt{/thozeewileiseero/?filter=value} instead of \texttt{/thozeewileiseero/cgi-bin/env.php?filter=value}, as showed in the web page resource. For this reason, I had a hard time figuring out how to set the \texttt{TESTENV} variable: I then found that the only way I could get it to work was by manually editing the HTTP requests.\\\\After solving the issue I started gathering ingo on bash vulnerabilities, and found out that the most common one was the Shellshock bug (CVE-2014-6271).
	The command I used to test if the application was vulnerable to Shellshock contained several characters that would be removed by the sanitization function (found in \texttt{sn.js}), so I decided to manually edit the HTTP request as shown below.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL13/shellshocktest}
		\label{fig:test13}
	\end{figure}
	The line "vulnerable" was correctly printed, so issued a \texttt{ls} command in the same way and discovered a file named \texttt{secret4uouO.txt}. Same as before, I printed the content of that file and received the secret.
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{LVL13/secret}
		\label{fig:secret13}
	\end{figure}
	
	%LEVEL 14
	\section*{Level 14}
	\textbf{URL: }\texttt{http://eth-lab.di.uniroma1.it:55367/aixedateediperai}\\
	\textbf{SECRET: }\texttt{}\\\\
	Because of the structure of the website and all the user-input forms, I initially suspected it might be vulnerable to SQL injections. To confirm that, I used the tool \texttt{sqlmap}. Since most of the web pages were using \texttt{POST} requests, I copied the content of such requests in a file, which was then used as an input to \texttt{sqlmap}. The syntax of the command was \texttt{sqlmap -r <request\_file> -p <test\_parameters>}. 

\end{document}
